<!DOCTYPE html>
<html>
    <head>
        <title>Gold Exchange</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.36/css/uikit.min.css" />

        <script type="text/javascript" src="https://unpkg.com/gold-exchange"></script>
        <script>
            let newCurrency = [
                { symbol: 'g', value: 1000 },
                { symbol: 'e', value: 100 },
                { symbol: 's', value: 10 },
                { symbol: 'c', value: 1 }
            ];
            let exchanger = new this["gold-exchange"].Exchanger({ rate: 1/50, newCurrency: newCurrency });

            let getInput = () => {
                return document.getElementById("input").value;
            }

            let setOutput = (output) => {
                let display = document.getElementById("output");
                display.textContent = output;
            }

            let parseInput = (input) => {
                let inputCoins = new Map();
                input = input.toLowerCase().split(' ');
                input.forEach( (i) => {
                    let symbol = i.match(/[a-z]/);
                    if (symbol) {
                        let quantity = parseInt(i);
                        if (inputCoins.has(symbol)) {
                            inputCoins.set(symbol, inputCoins.get(symbol) + quantity);
                        } else {
                            inputCoins.set(symbol, quantity);
                        }
                    }
                })
                let coins = [];
                inputCoins.forEach( (quantity, symbol) => {
                    coins.push({ symbol: symbol[0], quantity: quantity });
                })
                return coins;
            };

            let parseCoins = (coins) => {
                return coins.reduce( (output, coin) => {
                    return output += `${coin.quantity}${coin.symbol} `;
                }, '');
            }

            let exchangeCoins = (input) => {
                let coins = parseInput(input);
                let newCoins = exchanger.exchange(coins);
                let output = parseCoins(newCoins);

                setOutput(output);
            }

            let beginExchange = () => {
                let input = getInput();
                exchangeCoins(input);
            }

        </script>
    </head>
    <body>
        <div class="uk-container uk-text-center">
                <h1 class="uk-margin-large-top uk-heading-line uk-text-center"><span>Gold Exchange</span></h1>

                <div class="uk-margin-large-top" uk-grid>
                    <div class="uk-dark uk-background-muted uk-padding uk-width-2-3@s uk-width-1-2@m uk-margin-auto">
                        <input type="text" class="uk-input uk-text-center" id="input" oninput="beginExchange()" />
                        <div id="output" class="uk-margin-large-top uk-text-large uk-text-bold">0g 0e 0s 0c</div>
                    </div>
                </div>
        </div>
    </body>
</html>